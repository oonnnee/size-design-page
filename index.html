<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <title>填写个人信息</title>
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/index.css">
    <script src="js/jquery.js"></script>
    <script src="js/layer.js"></script>
    <script src="js/common.js"></script>
    <script>
        $.ajax({
            // url: 'http://localhost:8068/user/auth',
            url: 'http://measure.justalit.com:8068/user/auth',
            type: "get",
            async: false,
            xhrFields:{
                withCredentials:true
            },
            success: function (data) {
                if(data != 'true'){
                    location.href = '/login.html?r='+new Date().getTime();
                }
            },
            error: function(data) {
                myAlert('未知错误', function (index) {
                    layer.close(index);
                    location.href = '/login.html?r='+new Date().getTime();
                });
            }
        });
    </script>
    <script>
        $(function () {
            $.ajax({
                // url: 'http://localhost:8068/customer-info/get',
                url: 'http://measure.justalit.com:8068/customer-info/get',
                type: "get",
                async: false,
                xhrFields:{
                    withCredentials:true
                },
                success: function (data) {
                    if (data.code == 0){
                        var data = data.data;
                        if (data != null){
                            $('input[name=tbName]').val(data.tbName);
                            $('input[name=phone]').val(data.phone);
                            $('input[name=smallSize]').val(data.smallSize);
                            $('input[name=height]').val(data.height);
                            $('input[name=neckKnee]').val(data.neckKnee);
                            $('input[name=shoulderSleeve]').val(data.shoulderSleeve);
                            $('input[name=chest]').val(data.chest);
                            $('input[name=waist]').val(data.waist);
                            $('input[name=ass]').val(data.ass);
                            $('input[name=sleeveFat]').val(data.sleeveFat);
                            $('input[name=neck]').val(data.neck);
                            $('input[name=shoulder]').val(data.shoulder);
                            $('input[name=chestDistance]').val(data.chestDistance);
                            $('input[name=chestUp]').val(data.chestUp);
                            $('input[name=chestFront]').val(data.chestFront);
                            $('input[name=backWidth]').val(data.backWidth);
                            $('input[name=backLength]').val(data.backLength);
                            $('input[name=armLength]').val(data.armLength);
                            $('input[name=armUpLength]').val(data.armUpLength);
                            $('input[name=sleeveLength]').val(data.sleeveLength);
                            $('input[name=armWidth]').val(data.armWidth);
                            $('input[name=sleeveWidth]').val(data.sleeveWidth);
                            $('input[name=elbowWidth]').val(data.elbowWidth);
                            $('input[name=wristWidth]').val(data.wristWidth);
                            $('input[name=pants]').val(data.pants);
                            $('input[name=bigLagWidth]').val(data.bigLagWidth);
                            $('input[name=kneeWidth]').val(data.kneeWidth);
                            $('input[name=smallLagWidth]').val(data.smallLagWidth);
                            $('input[name=ankleWidth]').val(data.ankleWidth);
                            $('input[name=chestHeight]').val(data.chestHeight);
                            $('input[name=wristHeight]').val(data.wristHeight);
                            $('input[name=backMidLength]').val(data.backMidLength);
                            $('input[name=wristKnee]').val(data.wristKnee);
                            $('input[name=seventhLag]').val(data.seventhLag);
                        }
                    }
                },
                error: function() {
                    myAlert('未知错误', function (index) {
                        layer.close(index);
                        location.href = '/login.html?r='+new Date().getTime();
                    });
                }
            });
        });
    </script>
</head>
<body>
        <div id="container">
            <div id="header">
            </div>

            <div id="main">
                <form id="form">
                    <div class="input">
                        <span class="left_words">VIDEO TUTORIALS</span>
                        <span class="right_words" id="clickFirst">视频教程</span>
                    </div>
                    <!--隐藏视频播放框开始-->
                    <div id="hideVideo" class="hideVideo">
                        <video id="video" class="video" src="video/LetHerGo.mp4" controls="controls"></video>
                    </div>
                    <!--隐藏视频播放框结束-->

                    <div class="input">
                        <span class="left_words">REQUIRED FIELDS</span>
                        <span class="right_words" id="clickSecond">必填数据</span>
                    </div>
                        <!--必填数据框开始-->
                        <div id="hideRequiredData" class="hideRequiredData">
                            <br><br>
                            <div class="requiredData">
                                <span>淘宝名</span>
                                <input class="large" type="text" name="tbName" size="20" placeholder="在店铺下单时使用的淘宝ID">
                            </div>
                            <div class="requiredData">
                                <span>手机号码(test)</span>
                                <input class="large" type="text" name="phone" size="20" placeholder="在店铺下单时填写的手机号">
                            </div>
                            <div class="requiredData">
                                <span>平时码数</span>
                                <input class="large" type="text" name="smallSize" size="15" placeholder="仅填写S、L、M">
                            </div>
                            <div class="requiredData">
                                <span>身高</span>
                                <span class="cm">CM</span>
                                <input type="text" name="height" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>颈侧点—膝盖</span>
                                <span class="cm">CM</span>
                                <input type="text" name="neckKnee" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>1/2肩宽+袖长</span>
                                <span class="cm">CM</span>
                                <input type="text" name="shoulderSleeve" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>胸围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="chest" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>腰围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="waist" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>臀围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="ass" size="15" placeholder="点击输入">
                            </div>
                            <div class="requiredData">
                                <span>袖肥</span>
                                <span class="cm">CM</span>
                                <span id="requiredBracket">(上臂围)</span>
                                <input type="text" name="sleeveFat" size="15" placeholder="点击输入">
                            </div>
                            <br><br>
                        </div>
                        <!--必填数据框结束-->



                    <div class="input">
                        <span class="left_words">OPTIONAL FIELDS</span>
                        <span class="right_words" id="clickThird">选填数据</span>
                    </div>
                        <!--选填数据框开始-->
                        <div id="hideOptionalData" class="hideOptionalData">
                            <br><br>
                            <div class="optionalData">
                                <span>颈围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="neck" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>肩宽</span>
                                <span class="cm">CM</span>
                                <input type="text" name="shoulder" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>胸距</span>
                                <span class="cm">CM</span>
                                <input type="text" name="chestDistance" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>上胸围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="chestUp" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>前胸宽</span>
                                <span class="cm">CM</span>
                                <input type="text" name="chestFront" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>后背宽</span>
                                <span class="cm">CM</span>
                                <input type="text" name="backWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>背长</span>
                                <span class="cm">CM</span>
                                <input type="text" name="backLength" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>臂长</span>
                                <span class="cm">CM</span>
                                <span class="optionalBracket">(肩到手腕)</span>
                                <input type="text" name="armLength" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>上臂长</span>
                                <span class="cm">CM</span>
                                <span class="optionalBracket">(袖肘到肩)</span>
                                <input type="text" name="armUpLength" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>袖长</span>
                                <span class="cm">CM</span>
                                <span class="optionalBracket">(肩点到虎口)</span>
                                <input type="text" name="sleeveLength" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>臂围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="armWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>袖笼围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="sleeveWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>肘围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="elbowWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>手腕围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="wristWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>通档</span>
                                <span class="cm">CM</span>
                                <input type="text" name="pants" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>大腿根围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="bigLagWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>膝围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="kneeWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>小腿围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="smallLagWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>脚踝围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="ankleWidth" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>胸高</span>
                                <span class="cm">CM</span>
                                <input type="text" name="chestHeight" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>腰高</span>
                                <span class="cm">CM</span>
                                <span class="optionalBracket">(脚底—中腰)</span>
                                <input type="text" name="wristHeight" size="5" placeholder="点击输入">
                            </div>
                            <div class="optionalData">
                                <span>后中长</span>
                                <span class="cm">CM</span>
                                <span class="optionalBracket">(第七颈椎点—地面)</span>
                                <input type="text" name="backMidLength" size="5" placeholder="输入">
                            </div>
                            <div class="optionalData">
                                <span>中腰—膝盖距离</span>
                                <span class="cm">CM</span>
                                <input type="text" name="wristKnee" size="5" placeholder="输入">
                            </div>
                            <div class="optionalData">
                                <span>第七颈椎点—大腿根围</span>
                                <span class="cm">CM</span>
                                <input type="text" name="seventhLag" size="10" placeholder="输入">
                            </div>

                            <br><br>
                        </div>
                        <!--选填数据框结束-->
                </form>
                <button id="btn" onclick="submit()">提交数据</button>
            </div>
        </div>
        <script src="js/index.js"></script>
        <script>
            var curUserPhone = '';
            $.ajax({
                // url: 'http://localhost:8068/user/phone',
                url: 'http://measure.justalit.com:8068/user/phone',
                type: "get",
                async: false,
                xhrFields:{
                    withCredentials:true
                },
                success: function (data) {
                    curUserPhone = data;
                },
                error: function() {
                    myAlert('未知错误', function (index) {
                        layer.close(index);
                        location.href = '/login.html?r='+new Date().getTime();
                    });
                }
            });
            function submit() {
                myAlert('开始校验数据', function(index) {
                    layer.close(index);
                    var checks = ["phone", "tbName", "smallSize", "height", "neckKnee", "shoulderSleeve", "chest", "waist", "ass", "sleeveFat"];
                    for (var i=0; i<checks.length; i++){
                        var val = $('input[name='+checks[i]+']').val();
                        if (val.trim() == '') {
                            myAlert('必填数据不能为空');
                            return;
                        }

                        if (i == 0){
                            if (!/^\d{11}$/.test(val)){
                                myAlert('手机号格式错误');
                                return;
                            }
                            if (val != curUserPhone){
                                myAlert('手机号应与登陆号码一致');
                                return;
                            }

                        }

                        if (i == 2){
                            val = val.toUpperCase();
                            if (val!='S' && val!='M' && val!='L'){
                                myAlert('平时码数仅填写S、M、L');
                                return;
                            }
                        }

                        if (i > 2){
                            if (!isInputValid(val)) {
                                myAlert('测量值必须符合以下几点：\n1、数字\n2、非负数\n3、小数点最多一位');
                                return;
                            }
                        }
                    }

                    myAlert('数据校验成功，开始提交', function(index) {
                        var data = $("#form").serialize();

                        $('#btn').html('提交中...');
                        $('#btn').attr('disabled',true);

                        $.ajax({
                            // url: 'http://localhost:8068/customer-info/submit',
                            url: 'http://measure.justalit.com:8068/customer-info/submit',
                            type: "POST",
                            dataType: 'json',
                            data: data,
                            xhrFields:{
                                withCredentials:true
                            },
                            success: function (data) {
                                $('#btn').html('提交数据');
                                $('#btn').attr('disabled',false);
                                if(data.code == 0){
                                    myAlert('提交成功', function (index) {
                                        layer.close(index);
                                        location.href = '/ok.html?r='+new Date().getTime();
                                    });
                                }else if(data.code == 1){
                                    myAlert(data.data);
                                }else if(data.code == 2){
                                    myAlert(data.msg, function (index) {
                                        layer.close(index);
                                        location.href = '/login.html?r='+new Date().getTime();
                                    });
                                }else {
                                    myAlert('未知错误');
                                }
                            },
                            error: function() {
                                $('#btn').html('提交数据');
                                $('#btn').attr('disabled',false);
                                myAlert('未知错误');
                            }
                        });
                    });
                });

            }

            function isInputValid(val) {
                var regPos = /^\d+\.?\d?$/; //非负浮点数
                if(regPos.test(val) || val == '') {
                    return true;
                } else {
                    return false;
                }
            }
        </script>
</body>
</html>

