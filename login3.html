<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <title>Title</title>
    <link rel="stylesheet" href="css/login.css">
    <link rel="stylesheet" href="css/mediaQueriesForLogin.css">
</head>
<body>
<div id="container">
    <div id="main">
        <div action="#">
                         <div id="top">
                                <div class="input">
                                    <span class="leftWords" >手机号</span>
                                    <input id="phone" type="text" size="15" placeholder="请输入手机号">
                                    <span id="sendSmsBtn" class="rightWords" onclick="sendSMS();">获取验证码</span>
                                    <hr width="318px" size="1" color="white">
                                </div>
                                <div class="input">
                                    <span class="leftWords">验证码</span>
                                    <input id="code" type="text" size="15" placeholder="请输入验证码">
                                    <hr width="318px" size="1" color="white">
                                </div>
                         </div>
            <div id="bottom">
                <input type="button" value="开启定制之旅" onclick="login()">
            </div>

        </div>
    </div>
</div>
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript">

    var countdown=60;
    var interval;
    function sendSMS() {
        if (countdown != 60){
            return;
        }
        var phone = $('#phone').val();
        if (phone.length!=11 || phone.trim()==''){
            alert('手机号不存在');
            return;
        }
        $.ajax({
            url: 'http://measure.justalit.com:8068/sms/get/'+phone,
            // url: 'http://localhost:8068/sms/get/'+phone,
            type: "get",
            xhrFields:{
                withCredentials:true
            },
            success: function (data) {
                if (data.toUpperCase() == 'OK'){
                    interval = setInterval(function () {
                        countdown--;
                        if (countdown == 0){
                            clearInterval(interval);
                            $('#sendSmsBtn').html('重新发送');
                            countdown = 60;
                        }else{
                            $('#sendSmsBtn').html('重新发送('+countdown+')');
                        }
                    }, 1000);
                }else {
                    alert('请求验证码太频繁了');
                }
            },
            error: function(data) {
                alert('手机号不存在');
            }
        });
    }

    function login() {
        var phone = $('#phone').val();
        var code = $('#code').val();

        if (code.trim() == '') {
            alert('请输入验证码');
            return;
        }

        if (code.length != 6){
            alert('验证码格式错误');
            return;
        }

        $.ajax({
            // url: 'http://localhost:8068/sms/ok/'+phone+'/'+code,
            url: 'http://measure.justalit.com:8068/sms/ok/'+phone+'/'+code,
            type: "get",
            xhrFields:{
                withCredentials:true
            },
            success: function (data) {
                if (data == 'true'){
                    location.href = '/index.html';
                }else {
                    alert('验证码错误')
                }
            },
            error: function(data) {
                alert('未知错误');
            }
        });
    }

</script>
</body>
</html>
